{"ast":null,"code":"import * as actionTypes from './globalActionTypes';\nimport * as utility from '../utility';\nexport const APIfailure = () => ({\n  type: actionTypes.API_FAILURE,\n  newState: {\n    errorMessage: 'Uh Oh! We could not reach the server at this moment. Please ensure the API server is running.',\n    apiError: true\n  }\n});\nexport const updateSearchResults = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: 0,\n    searchTerm: searchResults.searchTerm,\n    searchResultsTotal: searchResults.searchResultsTotal\n  }\n});\nexport const updateCurrentPage = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: searchResults.currentPage\n  }\n});\nexport const updateRowsPerPage = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: 0,\n    rowsPerPage: searchResults.rowsPerPage\n  }\n});\nexport const updateResultsOrder = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: 0,\n    orderBy: searchResults.orderBy\n  }\n});\nexport const showMovie = movie => ({\n  type: actionTypes.TRIGGER_MOVIE,\n  newState: {\n    movieId: movie.id,\n    title: movie.title,\n    genres: movie.genres,\n    year: movie.year,\n    runtime: movie.runtime,\n    rating: movie.rating,\n    votes: movie.votes,\n    directors: movie.directors,\n    writers: movie.writers,\n    crew: movie.crew\n  }\n});\nexport const showCrew = crew => ({\n  type: actionTypes.TRIGGER_CREW,\n  newState: {\n    crewId: crew.crewId,\n    name: crew.name,\n    movies: crew.movies\n  }\n});\nexport const addToMovieSummaries = movie => ({\n  type: actionTypes.CREATE_CREW_MOVIES,\n  newState: {\n    newMovie: movie\n  }\n});\nexport const resetState = () => ({\n  type: actionTypes.RESET_STATE,\n  newState: {}\n}); // **********************************\n// ASYNC Functions\n// **********************************\n\nexport const searchMovies = searchTerm => (dispatch, getState) => {\n  fetch(`/movies?offset=0&size=10&query=${searchTerm}&sort=rating&order=desc`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(m => utility.extractMovieSummaries(m));\n    dispatch(updateSearchResults({\n      movieSummaries: movieSummaries,\n      searchResultsTotal: apiResponse.total\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const changePage = (event, newPage) => (dispatch, getState) => {\n  let {\n    searchTerm,\n    rowsPerPage,\n    orderBy\n  } = getState();\n  const offset = newPage * rowsPerPage;\n  fetch(`/movies?offset=${offset}&size=${rowsPerPage}&query=${searchTerm}&sort=${orderBy[0]}&order=${orderBy[1]}`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(m => utility.extractMovieSummaries(m));\n    dispatch(updateCurrentPage({\n      movieSummaries: movieSummaries,\n      currentPage: newPage\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const changeRowsPerPage = event => (dispatch, getState) => {\n  const {\n    searchTerm\n  } = getState();\n  const rows = parseInt(event.target.value, 10);\n  fetch(`/movies?offset=0&size=${rows}&query=${searchTerm}&sort=rating&order=desc`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(m => utility.extractMovieSummaries(m));\n    dispatch(updateRowsPerPage({\n      movieSummaries: movieSummaries,\n      rowsPerPage: rows\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const sortByTitleOrRating = (event, property) => (dispatch, getState) => {\n  const {\n    searchTerm,\n    rowsPerPage,\n    orderBy\n  } = getState();\n  orderBy[property].sort = orderBy[property].sort === 'asc' ? 'desc' : 'asc';\n  fetch(`/movies?offset=0&size=${rowsPerPage}&query=${searchTerm}&sort=${property}&order=${orderBy[property].sort}`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(m => utility.extractMovieSummaries(m));\n    dispatch(updateResultsOrder({\n      movieSummaries: movieSummaries,\n      orderBy: orderBy\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const findMovie = movie => (dispatch, getState) => {\n  fetch(`/movies/${movie}`).then(response => response.json()).then(apiResponse => {\n    const directors = apiResponse.directors.map(({\n      id,\n      name,\n      movies\n    }) => ({\n      memberId: id,\n      name,\n      movies,\n      roles: ['director']\n    }));\n    const writers = apiResponse.writers.map(({\n      id,\n      name,\n      movies\n    }) => ({\n      memberId: id,\n      name,\n      movies,\n      roles: ['writer']\n    }));\n    let crew = {};\n\n    for (let d of directors) {\n      crew[d.memberId] = {\n        name: d.name,\n        movies: d.movies,\n        roles: ['director']\n      };\n    }\n\n    for (let w of writers) {\n      if (crew[w.memberId]) {\n        crew[w.memberId].roles.push('writer');\n      } else {\n        crew[w.memberId] = {\n          name: w.name,\n          movies: w.movies,\n          roles: ['writer']\n        };\n      }\n    }\n\n    dispatch(showMovie({\n      movieId: apiResponse.id,\n      title: apiResponse.title,\n      genres: apiResponse.genres,\n      year: apiResponse.year,\n      runtime: apiResponse.runtime,\n      rating: apiResponse.rating,\n      votes: apiResponse.votes,\n      directors: directors,\n      writers: writers,\n      crew: crew\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const findCrew = crew => (dispatch, getState) => {\n  fetch(`/crew/${crew}`).then(response => response.json()).then(apiResponse => {\n    const movieIds = apiResponse.movies.map(({\n      id\n    }) => id);\n    movieIds.map(id => dispatch(findCrewMovie(id)));\n    dispatch(showCrew({\n      crewId: apiResponse.id,\n      name: apiResponse.name\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const findCrewMovie = movieId => (dispatch, getState) => {\n  fetch(`/movies/${movieId}`).then(response => response.json()).then(apiResponse => {\n    console.log(\"apiresponse \" + apiResponse);\n    dispatch(addToMovieSummaries({\n      movieId: apiResponse.id,\n      title: apiResponse.title,\n      rating: apiResponse.rating,\n      runtime: apiResponse.runtime\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};","map":{"version":3,"sources":["/Users/dkothandapani/Downloads/movie-app-react-typescript/src/store/actions/globalActions.tsx"],"names":["actionTypes","utility","APIfailure","type","API_FAILURE","newState","errorMessage","apiError","updateSearchResults","searchResults","TRIGGER_SEARCH","movieSummaries","currentPage","searchTerm","searchResultsTotal","updateCurrentPage","updateRowsPerPage","rowsPerPage","updateResultsOrder","orderBy","showMovie","movie","TRIGGER_MOVIE","movieId","id","title","genres","year","runtime","rating","votes","directors","writers","crew","showCrew","TRIGGER_CREW","crewId","name","movies","addToMovieSummaries","CREATE_CREW_MOVIES","newMovie","resetState","RESET_STATE","searchMovies","dispatch","getState","fetch","then","response","json","apiResponse","allMovies","items","map","m","extractMovieSummaries","total","catch","ex","changePage","event","newPage","offset","changeRowsPerPage","rows","parseInt","target","value","sortByTitleOrRating","property","sort","findMovie","memberId","roles","d","w","push","findCrew","movieIds","findCrewMovie","console","log"],"mappings":"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","sourcesContent":["import * as actionTypes from './globalActionTypes'\nimport * as utility from '../utility'\n\nexport const APIfailure = () => ({\n    type: actionTypes.API_FAILURE,\n    newState: {\n        errorMessage: 'Uh Oh! We could not reach the server at this moment. Please ensure the API server is running.',\n        apiError: true,\n    }\n})\n\nexport const updateSearchResults = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: 0,\n        searchTerm: searchResults.searchTerm,\n        searchResultsTotal: searchResults.searchResultsTotal,\n\n    }\n})\n\nexport const updateCurrentPage = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: searchResults.currentPage,\n    }\n})\n\nexport const updateRowsPerPage = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: 0,\n        rowsPerPage: searchResults.rowsPerPage\n    }\n})\n\nexport const updateResultsOrder = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: 0,\n        orderBy: searchResults.orderBy\n    }\n})\n\nexport const showMovie = (movie: any) => ({\n    type: actionTypes.TRIGGER_MOVIE,\n    newState: {\n        movieId: movie.id,\n        title: movie.title,\n        genres: movie.genres,\n        year: movie.year,\n        runtime: movie.runtime,\n        rating: movie.rating,\n        votes: movie.votes,\n        directors: movie.directors,\n        writers: movie.writers,\n        crew: movie.crew\n    }\n})\n\nexport const showCrew = (crew: any) => ({\n    type: actionTypes.TRIGGER_CREW,\n    newState: {\n        crewId: crew.crewId,\n        name: crew.name,\n        movies: crew.movies,\n    }\n})\n\nexport const addToMovieSummaries = (movie: any) => ({\n    type: actionTypes.CREATE_CREW_MOVIES,\n    newState: {\n        newMovie: movie\n    }\n})\n\nexport const resetState = () => ({\n    type: actionTypes.RESET_STATE,\n    newState: {}\n\n})\n\n// **********************************\n// ASYNC Functions\n// **********************************\n\nexport const searchMovies = (searchTerm: string) => (dispatch: any, getState: any) => {\n    fetch(`/movies?offset=0&size=10&query=${searchTerm}&sort=rating&order=desc`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map((m: any) => utility.extractMovieSummaries(m))\n            dispatch(updateSearchResults({\n                movieSummaries: movieSummaries,\n                searchResultsTotal: apiResponse.total\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const changePage = (event: any, newPage: number) => (dispatch: any, getState: any) => {\n    let {searchTerm, rowsPerPage, orderBy} = getState()\n    const offset = newPage * rowsPerPage\n\n    fetch(`/movies?offset=${offset}&size=${rowsPerPage}&query=${searchTerm}&sort=${orderBy[0]}&order=${orderBy[1]}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map((m: any) => utility.extractMovieSummaries(m))\n            dispatch(updateCurrentPage({\n                movieSummaries: movieSummaries,\n                currentPage: newPage,\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const changeRowsPerPage = (event: React.ChangeEvent<HTMLInputElement>) => (dispatch: any, getState: any) => {\n    const {searchTerm} = getState()\n    const rows = parseInt(event.target.value, 10)\n\n    fetch(`/movies?offset=0&size=${rows}&query=${searchTerm}&sort=rating&order=desc`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map((m: any) => utility.extractMovieSummaries(m))\n            dispatch(updateRowsPerPage({\n                movieSummaries: movieSummaries,\n                rowsPerPage: rows\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const sortByTitleOrRating = (event: any, property: any) => (dispatch: any, getState: any) => {\n    const {searchTerm, rowsPerPage, orderBy} = getState()\n    orderBy[property].sort = orderBy[property].sort === 'asc' ? 'desc' : 'asc'\n\n    fetch(`/movies?offset=0&size=${rowsPerPage}&query=${searchTerm}&sort=${property}&order=${orderBy[property].sort}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map((m: any) => utility.extractMovieSummaries(m))\n            dispatch(updateResultsOrder({\n                movieSummaries: movieSummaries,\n                orderBy: orderBy\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const findMovie = (movie: string) => (dispatch: any, getState: any) => {\n    fetch(`/movies/${movie}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n\n                const directors = apiResponse.directors.map(({id, name, movies}: any) => ({\n                    memberId: id,\n                    name,\n                    movies,\n                    roles: ['director']\n                }))\n                const writers = apiResponse.writers.map(({id, name, movies}: any) => ({\n                    memberId: id,\n                    name,\n                    movies,\n                    roles: ['writer']\n                }))\n\n                let crew: any = {}\n                for (let d of directors) {\n                    crew[d.memberId] = {name: d.name, movies: d.movies, roles: ['director']}\n                }\n\n                for (let w of writers) {\n                    if (crew[w.memberId]) {\n                        crew[w.memberId].roles.push('writer')\n                    } else {\n                        crew[w.memberId] = {name: w.name, movies: w.movies, roles: ['writer']}\n                    }\n\n                }\n\n                dispatch(showMovie({\n                    movieId: apiResponse.id,\n                    title: apiResponse.title,\n                    genres: apiResponse.genres,\n                    year: apiResponse.year,\n                    runtime: apiResponse.runtime,\n                    rating: apiResponse.rating,\n                    votes: apiResponse.votes,\n                    directors: directors,\n                    writers: writers,\n                    crew: crew\n                }));\n            }\n        )\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const findCrew = (crew: string) => (dispatch: any, getState: any) => {\n    fetch(`/crew/${crew}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const movieIds = apiResponse.movies.map(({id}: any) => (id))\n            movieIds.map((id: any) => dispatch(findCrewMovie(id)))\n            dispatch(showCrew({\n                crewId: apiResponse.id,\n                name: apiResponse.name,\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const findCrewMovie = (movieId: any) => (dispatch: any, getState: any) => {\n    fetch(`/movies/${movieId}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            console.log(\"apiresponse \" + apiResponse)\n            dispatch(addToMovieSummaries({\n                movieId: apiResponse.id,\n                title: apiResponse.title,\n                rating: apiResponse.rating,\n                runtime: apiResponse.runtime\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\n"]},"metadata":{},"sourceType":"module"}