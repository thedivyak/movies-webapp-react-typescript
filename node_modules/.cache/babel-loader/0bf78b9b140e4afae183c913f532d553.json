{"ast":null,"code":"import * as actionTypes from './globalActionTypes';\nexport const APIfailure = () => ({\n  type: actionTypes.API_FAILURE,\n  newState: {\n    errorMessage: 'Uh Oh! We could not reach the server at this moment. Please ensure the API server is running.'\n  }\n});\nexport const showAllMovies = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    searchTerm: '',\n    movieSummaries: searchResults.movieSummaries,\n    searchResultsTotal: searchResults.searchResultsTotal,\n    currentPage: 0\n  }\n});\nexport const updateSearchResults = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: 0,\n    searchTerm: searchResults.searchTerm,\n    searchResultsTotal: searchResults.searchResultsTotal\n  }\n});\nexport const updateCurrentPage = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: searchResults.currentPage\n  }\n});\nexport const updateRowsPerPage = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: 0,\n    rowsPerPage: searchResults.rowsPerPage\n  }\n});\nexport const updateResultsOrder = searchResults => ({\n  type: actionTypes.TRIGGER_SEARCH,\n  newState: {\n    movieSummaries: searchResults.movieSummaries,\n    currentPage: 0,\n    orderBy: searchResults.orderBy\n  }\n});\nexport const showMovie = movie => ({\n  type: actionTypes.TRIGGER_MOVIE,\n  newState: {\n    movieId: movie.id,\n    title: movie.title,\n    genres: movie.genres,\n    year: movie.year,\n    runtime: movie.runtime,\n    rating: movie.rating,\n    votes: movie.votes,\n    directors: movie.directors,\n    writers: movie.writers,\n    crew: movie.crew\n  }\n});\nexport const showCrew = crew => ({\n  type: actionTypes.TRIGGER_CREW,\n  newState: {\n    crewId: crew.crewId,\n    name: crew.name,\n    movies: crew.movies\n  }\n});\nexport const addToMovieSummaries = movie => ({\n  type: actionTypes.CREATE_CREW_MOVIE,\n  newState: {\n    newMovie: movie\n  }\n});\nexport const resetState = () => ({\n  type: actionTypes.RESET_STATE,\n  newState: {}\n}); // **********************************\n// ASYNC Functions\n// **********************************\n\nexport const allMovies = () => (dispatch, getState) => {\n  let {\n    searchTerm,\n    rowsPerPage\n  } = getState();\n  fetch(`/movies?offset=0&size=${rowsPerPage}&query=${searchTerm}&sort=rating&order=desc`) // .then(utility.handleFetchErrors)\n  .then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(({\n      id,\n      title,\n      rating,\n      runtime,\n      genres\n    }) => ({\n      movieId: id,\n      title,\n      rating,\n      runtime,\n      genres\n    }));\n    dispatch(showAllMovies({\n      movieSummaries: movieSummaries,\n      searchResultsTotal: apiResponse.total\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const searchMovies = searchTerm => (dispatch, getState) => {\n  fetch(`/movies?offset=0&size=10&query=${searchTerm}&sort=rating&order=desc`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(({\n      id,\n      title,\n      rating,\n      runtime\n    }) => ({\n      movieId: id,\n      title,\n      rating,\n      runtime\n    }));\n    dispatch(updateSearchResults({\n      movieSummaries: movieSummaries,\n      searchTerm: searchTerm,\n      searchResultsTotal: apiResponse.total\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const changePage = (event, newPage) => (dispatch, getState) => {\n  let {\n    searchTerm,\n    rowsPerPage,\n    orderBy\n  } = getState();\n  const offset = newPage * rowsPerPage;\n  fetch(`/movies?offset=${offset}&size=${rowsPerPage}&query=${searchTerm}&sort=${orderBy[0]}&order=${orderBy[1]}`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(({\n      id,\n      title,\n      rating,\n      runtime\n    }) => ({\n      movieId: id,\n      title,\n      rating,\n      runtime\n    }));\n    dispatch(updateCurrentPage({\n      movieSummaries: movieSummaries,\n      currentPage: newPage\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const changeRowsPerPage = event => (dispatch, getState) => {\n  const {\n    searchTerm\n  } = getState();\n  const rows = parseInt(event.target.value, 10);\n  fetch(`/movies?offset=0&size=${rows}&query=${searchTerm}&sort=rating&order=desc`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(({\n      id,\n      title,\n      rating,\n      runtime\n    }) => ({\n      movieId: id,\n      title,\n      rating,\n      runtime\n    }));\n    dispatch(updateRowsPerPage({\n      movieSummaries: movieSummaries,\n      rowsPerPage: rows\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const sortByTitleOrRating = (event, property) => (dispatch, getState) => {\n  const {\n    searchTerm,\n    rowsPerPage,\n    orderBy\n  } = getState();\n  orderBy[property].sort = orderBy[property].sort === 'asc' ? 'desc' : 'asc';\n  fetch(`/movies?offset=0&size=${rowsPerPage}&query=${searchTerm}&sort=${property}&order=${orderBy[property].sort}`).then(response => response.json()).then(apiResponse => {\n    const allMovies = apiResponse.items;\n    const movieSummaries = allMovies.map(({\n      id,\n      title,\n      rating,\n      runtime\n    }) => ({\n      movieId: id,\n      title,\n      rating,\n      runtime\n    }));\n    dispatch(updateResultsOrder({\n      movieSummaries: movieSummaries,\n      orderBy: orderBy\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const findMovie = movie => (dispatch, getState) => {\n  fetch(`/movies/${movie}`).then(response => response.json()).then(apiResponse => {\n    const directors = apiResponse.directors.map(({\n      id,\n      name,\n      movies\n    }) => ({\n      memberId: id,\n      name,\n      movies,\n      roles: ['director']\n    }));\n    const writers = apiResponse.writers.map(({\n      id,\n      name,\n      movies\n    }) => ({\n      memberId: id,\n      name,\n      movies,\n      roles: ['writer']\n    }));\n    let crew = {};\n\n    for (let d of directors) {\n      crew[d.memberId] = {\n        name: d.name,\n        movies: d.movies,\n        roles: ['director']\n      };\n    }\n\n    for (let w of writers) {\n      if (crew[w.memberId]) {\n        crew[w.memberId].roles.push('writer');\n      } else {\n        crew[w.memberId] = {\n          name: w.name,\n          movies: w.movies,\n          roles: ['writer']\n        };\n      }\n    }\n\n    dispatch(showMovie({\n      movieId: apiResponse.id,\n      title: apiResponse.title,\n      genres: apiResponse.genres,\n      year: apiResponse.year,\n      runtime: apiResponse.runtime,\n      rating: apiResponse.rating,\n      votes: apiResponse.votes,\n      directors: directors,\n      writers: writers,\n      crew: crew\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const findCrew = crew => (dispatch, getState) => {\n  fetch(`/crew/${crew}`).then(response => response.json()).then(apiResponse => {\n    const movieIds = apiResponse.movies.map(({\n      id\n    }) => id);\n    movieIds.map(id => dispatch(findCrewMovie(id)));\n    dispatch(showCrew({\n      crewId: apiResponse.id,\n      name: apiResponse.name\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};\nexport const findCrewMovie = movieId => (dispatch, getState) => {\n  console.log(movieId);\n  fetch(`/movies/${movieId}`).then(response => response.json()).then(apiResponse => {\n    console.log(\"apiresponse \" + apiResponse);\n    dispatch(addToMovieSummaries({\n      movieId: apiResponse.id,\n      title: apiResponse.title,\n      rating: apiResponse.rating,\n      runtime: apiResponse.runtime\n    }));\n  }).catch(ex => dispatch(APIfailure()));\n};","map":{"version":3,"sources":["/Users/dkothandapani/Downloads/movie-app-react-typescript/src/store/actions/globalActions.tsx"],"names":["actionTypes","APIfailure","type","API_FAILURE","newState","errorMessage","showAllMovies","searchResults","TRIGGER_SEARCH","searchTerm","movieSummaries","searchResultsTotal","currentPage","updateSearchResults","updateCurrentPage","updateRowsPerPage","rowsPerPage","updateResultsOrder","orderBy","showMovie","movie","TRIGGER_MOVIE","movieId","id","title","genres","year","runtime","rating","votes","directors","writers","crew","showCrew","TRIGGER_CREW","crewId","name","movies","addToMovieSummaries","CREATE_CREW_MOVIE","newMovie","resetState","RESET_STATE","allMovies","dispatch","getState","fetch","then","response","json","apiResponse","items","map","total","catch","ex","searchMovies","changePage","event","newPage","offset","changeRowsPerPage","rows","parseInt","target","value","sortByTitleOrRating","property","sort","findMovie","memberId","roles","d","w","push","findCrew","movieIds","findCrewMovie","console","log"],"mappings":"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","sourcesContent":["import * as actionTypes from './globalActionTypes'\nimport * as utility from '../utility'\n\nexport const APIfailure = () => ({\n    type: actionTypes.API_FAILURE,\n    newState: {\n        errorMessage: 'Uh Oh! We could not reach the server at this moment. Please ensure the API server is running.'\n    }\n})\n\nexport const showAllMovies = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        searchTerm: '',\n        movieSummaries: searchResults.movieSummaries,\n        searchResultsTotal: searchResults.searchResultsTotal,\n        currentPage: 0\n    }\n})\n\nexport const updateSearchResults = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: 0,\n        searchTerm: searchResults.searchTerm,\n        searchResultsTotal: searchResults.searchResultsTotal,\n\n    }\n})\n\nexport const updateCurrentPage = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: searchResults.currentPage,\n    }\n})\n\nexport const updateRowsPerPage = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: 0,\n        rowsPerPage: searchResults.rowsPerPage\n    }\n})\n\nexport const updateResultsOrder = (searchResults: any) => ({\n    type: actionTypes.TRIGGER_SEARCH,\n    newState: {\n        movieSummaries: searchResults.movieSummaries,\n        currentPage: 0,\n        orderBy: searchResults.orderBy\n    }\n})\n\nexport const showMovie = (movie: any) => ({\n    type: actionTypes.TRIGGER_MOVIE,\n    newState: {\n        movieId: movie.id,\n        title: movie.title,\n        genres: movie.genres,\n        year: movie.year,\n        runtime: movie.runtime,\n        rating: movie.rating,\n        votes: movie.votes,\n        directors: movie.directors,\n        writers: movie.writers,\n        crew: movie.crew\n    }\n})\n\nexport const showCrew = (crew: any) => ({\n    type: actionTypes.TRIGGER_CREW,\n    newState: {\n        crewId: crew.crewId,\n        name: crew.name,\n        movies: crew.movies,\n    }\n})\n\nexport const addToMovieSummaries = (movie: any) => ({\n    type: actionTypes.CREATE_CREW_MOVIE,\n    newState: {\n        newMovie: movie\n    }\n})\n\nexport const resetState = () => ({\n    type: actionTypes.RESET_STATE,\n    newState: {}\n\n})\n\n// **********************************\n// ASYNC Functions\n// **********************************\n\nexport const allMovies = () => (dispatch: any, getState: any) => {\n    let {searchTerm, rowsPerPage} = getState()\n    fetch(`/movies?offset=0&size=${rowsPerPage}&query=${searchTerm}&sort=rating&order=desc`)\n        // .then(utility.handleFetchErrors)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map(\n                ({id, title, rating, runtime, genres}: any) => ({movieId: id, title, rating, runtime, genres})\n            )\n            dispatch(showAllMovies({\n                movieSummaries: movieSummaries,\n                searchResultsTotal: apiResponse.total\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const searchMovies = (searchTerm: string) => (dispatch: any, getState: any) => {\n\n    fetch(`/movies?offset=0&size=10&query=${searchTerm}&sort=rating&order=desc`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map(\n                ({id, title, rating, runtime}: any) => ({movieId: id, title, rating, runtime})\n            )\n            dispatch(updateSearchResults({\n                movieSummaries: movieSummaries,\n                searchTerm: searchTerm,\n                searchResultsTotal: apiResponse.total\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const changePage = (event: any, newPage: number) => (dispatch: any, getState: any) => {\n    let {searchTerm, rowsPerPage, orderBy} = getState()\n    const offset = newPage * rowsPerPage\n\n    fetch(`/movies?offset=${offset}&size=${rowsPerPage}&query=${searchTerm}&sort=${orderBy[0]}&order=${orderBy[1]}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map(\n                ({id, title, rating, runtime}: any) => ({movieId: id, title, rating, runtime})\n            )\n            dispatch(updateCurrentPage({\n                movieSummaries: movieSummaries,\n                currentPage: newPage,\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const changeRowsPerPage = (event: React.ChangeEvent<HTMLInputElement>) => (dispatch: any, getState: any) => {\n    const {searchTerm} = getState()\n    const rows = parseInt(event.target.value, 10)\n\n    fetch(`/movies?offset=0&size=${rows}&query=${searchTerm}&sort=rating&order=desc`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map(\n                ({id, title, rating, runtime}: any) => ({movieId: id, title, rating, runtime})\n            )\n            dispatch(updateRowsPerPage({\n                movieSummaries: movieSummaries,\n                rowsPerPage: rows\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const sortByTitleOrRating = (event: any, property: any) => (dispatch: any, getState: any) => {\n    const {searchTerm, rowsPerPage, orderBy} = getState()\n    orderBy[property].sort = orderBy[property].sort === 'asc' ? 'desc' : 'asc'\n\n    fetch(`/movies?offset=0&size=${rowsPerPage}&query=${searchTerm}&sort=${property}&order=${orderBy[property].sort}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const allMovies = apiResponse.items\n            const movieSummaries = allMovies.map(\n                ({id, title, rating, runtime}: any) => ({movieId: id, title, rating, runtime})\n            )\n            dispatch(updateResultsOrder({\n                movieSummaries: movieSummaries,\n                orderBy: orderBy\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const findMovie = (movie: string) => (dispatch: any, getState: any) => {\n\n    fetch(`/movies/${movie}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n\n                const directors = apiResponse.directors.map(({id, name, movies}: any) => ({\n                    memberId: id,\n                    name,\n                    movies,\n                    roles: ['director']\n                }))\n                const writers = apiResponse.writers.map(({id, name, movies}: any) => ({\n                    memberId: id,\n                    name,\n                    movies,\n                    roles: ['writer']\n                }))\n\n                let crew: any = {}\n                for (let d of directors) {\n                    crew[d.memberId] = {name: d.name, movies: d.movies, roles: ['director']}\n                }\n\n                for (let w of writers) {\n                    if (crew[w.memberId]) {\n                        crew[w.memberId].roles.push('writer')\n                    } else {\n                        crew[w.memberId] = {name: w.name, movies: w.movies, roles: ['writer']}\n                    }\n\n                }\n\n                dispatch(showMovie({\n                    movieId: apiResponse.id,\n                    title: apiResponse.title,\n                    genres: apiResponse.genres,\n                    year: apiResponse.year,\n                    runtime: apiResponse.runtime,\n                    rating: apiResponse.rating,\n                    votes: apiResponse.votes,\n                    directors: directors,\n                    writers: writers,\n                    crew: crew\n                }));\n            }\n        )\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const findCrew = (crew: string) => (dispatch: any, getState: any) => {\n\n    fetch(`/crew/${crew}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            const movieIds = apiResponse.movies.map(({id}: any) => (id))\n            movieIds.map((id: any) => dispatch(findCrewMovie(id)))\n            dispatch(showCrew({\n                crewId: apiResponse.id,\n                name: apiResponse.name,\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\nexport const findCrewMovie = (movieId: any) => (dispatch: any, getState: any) => {\n    console.log(movieId)\n\n    fetch(`/movies/${movieId}`)\n        .then((response) => response.json())\n        .then(apiResponse => {\n            console.log(\"apiresponse \" + apiResponse)\n            dispatch(addToMovieSummaries({\n                movieId: apiResponse.id,\n                title: apiResponse.title,\n                rating: apiResponse.rating,\n                runtime: apiResponse.runtime\n            }));\n        })\n        .catch(ex => dispatch(APIfailure()))\n}\n\n"]},"metadata":{},"sourceType":"module"}